<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>x402 Agent Economy</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="header-left">
          <h1>x402 <span class="dim">//</span> MULTI-MECHANISM FACILITATOR</h1>
          <span class="header-sub"
            >EIP-7702 (USDT) + ERC-3009 (USDC) payment settlement</span
          >
        </div>
        <div class="header-right">
          <div class="status-badge" id="system-status">ONLINE</div>
        </div>
      </header>

      <main>
        <!-- Protocol Timeline -->
        <div class="timeline-bar">
          <div
            class="timeline-step"
            id="ts-1"
            data-tooltip="Buyer requests a paid resource from the Seller API"
          >
            <div class="ts-num">1</div>
            <div class="ts-label">REQUEST</div>
            <div class="ts-detail">GET /weather</div>
          </div>
          <div class="timeline-connector"></div>
          <div
            class="timeline-step"
            id="ts-2"
            data-tooltip="Seller responds with HTTP 402 and payment requirements in headers"
          >
            <div class="ts-num">2</div>
            <div class="ts-label">402 RESPONSE</div>
            <div class="ts-detail">PAYMENT-REQUIRED</div>
          </div>
          <div class="timeline-connector"></div>
          <div
            class="timeline-step"
            id="ts-3"
            data-tooltip="Buyer signs payment authorization — EIP-712 + EIP-7702 for USDT, or ERC-3009 TransferWithAuthorization for USDC"
          >
            <div class="ts-num">3</div>
            <div class="ts-label">SIGN</div>
            <div class="ts-detail" id="ts-3-detail">EIP-712 + EIP-7702</div>
          </div>
          <div class="timeline-connector"></div>
          <div
            class="timeline-step"
            id="ts-4"
            data-tooltip="Buyer retries the request with the signed payment in the PAYMENT-SIGNATURE header"
          >
            <div class="ts-num">4</div>
            <div class="ts-label">RETRY</div>
            <div class="ts-detail">+ PAYMENT-SIGNATURE</div>
          </div>
          <div class="timeline-connector"></div>
          <div
            class="timeline-step"
            id="ts-5"
            data-tooltip="Seller forwards the payment to the Facilitator. First POST /verify (read-only checks), then POST /settle (consumes nonce + submits Type 4 tx on-chain)"
          >
            <div class="ts-num">5</div>
            <div class="ts-label">VERIFY + SETTLE</div>
            <div class="ts-detail">Facilitator -> Chain</div>
          </div>
          <div class="timeline-connector"></div>
          <div
            class="timeline-step"
            id="ts-6"
            data-tooltip="Tokens transferred on-chain via EIP-7702 delegation. Seller delivers the paid data to Buyer."
          >
            <div class="ts-num">6</div>
            <div class="ts-label">DELIVER</div>
            <div class="ts-detail">200 + Data</div>
          </div>
        </div>

        <!-- Agent Network -->
        <div class="network">
          <!-- Buyer Card -->
          <div class="node" id="node-buyer">
            <div class="node-header">
              <div class="node-dot buyer-dot"></div>
              <div class="node-title">BUYER AGENT</div>
            </div>
            <div class="node-role">Autonomous Consumer</div>
            <div class="node-address" id="buyer-addr">0x8626...67eB</div>

            <div class="node-stats">
              <div class="stat">
                <div class="stat-label">USDT</div>
                <div class="stat-value" id="buyer-usdt">--.--</div>
              </div>
              <div class="stat">
                <div class="stat-label">USDC</div>
                <div class="stat-value" id="buyer-usdc">--.--</div>
              </div>
            </div>

            <div class="node-status" id="buyer-status">IDLE</div>

            <!-- Token Indicator -->
            <div class="token-indicator hidden" id="token-indicator"></div>

            <!-- Signature Detail Panel -->
            <div class="detail-panel hidden" id="buyer-detail">
              <div class="detail-title">SIGNATURES</div>
              <div class="detail-row">
                <span class="detail-key" id="sig-label-1">EIP-712</span>
                <span class="detail-val" id="sig-712">--</span>
              </div>
              <div class="detail-row">
                <span class="detail-key" id="sig-label-2">EIP-7702</span>
                <span class="detail-val" id="sig-7702">--</span>
              </div>
            </div>

            <!-- Weather Result -->
            <div class="weather-result hidden" id="weather-result">
              <div class="wr-icon">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                >
                  <circle cx="12" cy="12" r="5"></circle>
                  <line x1="12" y1="1" x2="12" y2="3"></line>
                  <line x1="12" y1="21" x2="12" y2="23"></line>
                  <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                  <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                  <line x1="1" y1="12" x2="3" y2="12"></line>
                  <line x1="21" y1="12" x2="23" y2="12"></line>
                  <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                  <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
              </div>
              <div class="wr-data">
                <div class="wr-temp" id="wr-temp">--</div>
                <div class="wr-loc" id="wr-loc">--</div>
              </div>
              <div class="wr-badge">PAID DATA</div>
            </div>
          </div>

          <!-- Connection Area with animated packets -->
          <div class="connections">
            <!-- Message Bar -->
            <div class="message-bar hidden" id="message-bar"></div>

            <svg width="100%" height="100%" id="conn-svg">
              <!-- Lines drawn by JS -->
            </svg>

            <!-- Facilitator Card (center-bottom) -->
            <div class="node facilitator-node" id="node-facilitator">
              <div class="node-header">
                <div class="fac-core" id="fac-core">
                  <div class="fac-core-inner"></div>
                </div>
                <div class="node-title">FACILITATOR</div>
              </div>
              <div class="node-role">Multi-Mechanism Relayer</div>

              <div class="node-stats">
                <div class="stat wide">
                  <div class="stat-label">RELAYER GAS (ETH)</div>
                  <div class="stat-value" id="fac-eth">--.--</div>
                </div>
              </div>

              <div class="node-status" id="fac-status">READY</div>

              <!-- Settlement Detail Panel -->
              <div class="detail-panel hidden" id="fac-detail">
                <div class="detail-title">SETTLEMENT</div>
                <div class="detail-row">
                  <span class="detail-key">Verify</span>
                  <span class="detail-val" id="fac-verify">--</span>
                </div>
                <div class="detail-row">
                  <span class="detail-key">Tx Type</span>
                  <span class="detail-val" id="fac-txtype">--</span>
                </div>
                <div class="detail-row">
                  <span class="detail-key">Tx Hash</span>
                  <span class="detail-val mono" id="fac-txhash">--</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Seller Card -->
          <div class="node" id="node-seller">
            <div class="node-header">
              <div class="node-dot seller-dot"></div>
              <div class="node-title">SELLER AGENT</div>
            </div>
            <div class="node-role">Weather Data Provider</div>
            <div class="node-address" id="seller-addr">0x3C44...F902</div>

            <div class="node-stats">
              <div class="stat">
                <div class="stat-label">USDT</div>
                <div class="stat-value" id="seller-usdt">--.--</div>
              </div>
              <div class="stat">
                <div class="stat-label">USDC</div>
                <div class="stat-value" id="seller-usdc">--.--</div>
              </div>
            </div>

            <div class="node-status" id="seller-status">LISTENING</div>

            <!-- Price Tag -->
            <div class="price-tag">
              <div class="price-label">PRICE</div>
              <div class="price-value">1 USDT or 1 USDC / request</div>
            </div>
          </div>
        </div>

        <!-- Bottom: Explanation + Logs side by side -->
        <div class="bottom-panels">
          <!-- Explanation Panel -->
          <div class="explain-panel" id="explain-panel">
            <div class="explain-header">PROTOCOL EXPLANATION</div>
            <div class="explain-body" id="explain-body">
              <p>
                Click <strong>USDT</strong> or <strong>USDC</strong> to initiate a purchase.
                The visualization shows each step of the x402 protocol in real
                time.
              </p>
              <p class="dim">
                USDT uses EIP-7702 delegation. USDC uses ERC-3009 transferWithAuthorization.
                Both are settled by the same Facilitator — the Buyer never pays gas.
              </p>
            </div>
          </div>

          <!-- Log Console -->
          <div class="console-panel">
            <div class="console-header">
              <span>SYSTEM LOG</span>
              <div class="console-controls">
                <button class="btn-mode" id="mode-toggle">AUTO</button>
                <button class="btn-initiate btn-usdt" id="buy-usdt-btn">USDT</button>
                <button class="btn-initiate btn-usdc" id="buy-usdc-btn">USDC</button>
                <button class="btn-initiate btn-next hidden" id="next-btn">
                  NEXT →
                </button>
              </div>
            </div>
            <div class="console-output" id="logs-container">
              <div class="log-entry sys">
                [SYS] Waiting for agent activity...
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script src="script.js"></script>
  </body>
</html>
